<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DELS BASE | Official Telegram Mini App</title>
    <!-- Подключаем SDK Телеграма -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg: #000000;
            --panel: #161618;
            --accent: #5856d6;
            --accent-glow: rgba(88, 86, 214, 0.4);
            --text: #ffffff;
            --hint: #8e8e93;
            --danger: #ff3b30;
            --success: #34c759;
            --border: rgba(255, 255, 255, 0.08);
            --spring: cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        ::-webkit-scrollbar { display: none; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* --- Анимации --- */
        @keyframes pageIn {
            from { opacity: 0; transform: scale(0.95) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        .animate { animation: pageIn 0.4s var(--spring) forwards; }

        @keyframes scamGlow {
            0% { box-shadow: 0 0 5px var(--danger); }
            50% { box-shadow: 0 0 20px var(--danger); }
            100% { box-shadow: 0 0 5px var(--danger); }
        }

        /* --- HEADER --- */
        header {
            height: 70px;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid var(--border);
        }

        .logo { font-size: 20px; font-weight: 900; letter-spacing: -0.5px; text-transform: uppercase; cursor: pointer; }
        .logo span { color: var(--accent); }

        .user-pill {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 5px 5px 5px 12px;
            border-radius: 50px;
            background: #1c1c1e;
            border: 1px solid var(--border);
            transition: 0.3s;
        }
        .user-pill:active { transform: scale(0.95); }
        .user-pill img { width: 30px; height: 30px; border-radius: 50%; object-fit: cover; border: 1.5px solid var(--accent); }

        /* --- MAIN --- */
        main { padding: 20px; max-width: 500px; margin: 0 auto; }

        .menu-card {
            background: var(--panel);
            padding: 22px;
            border-radius: 26px;
            display: flex;
            align-items: center;
            gap: 18px;
            cursor: pointer;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            transition: 0.3s var(--spring);
        }
        .menu-card:active { transform: scale(0.97); background: #222224; }

        .icon-box {
            width: 50px; height: 50px; border-radius: 16px;
            display: flex; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.03);
            color: var(--accent);
        }

        /* --- PROFILE CARD --- */
        .glass-panel {
            background: var(--panel);
            border-radius: 35px;
            padding: 35px;
            border: 1px solid var(--border);
            text-align: center;
            position: relative;
        }

        .scam-tag {
            background: var(--danger);
            color: #fff;
            font-size: 11px;
            font-weight: 900;
            padding: 4px 12px;
            border-radius: 8px;
            display: inline-block;
            margin-top: 10px;
            animation: scamGlow 2s infinite;
        }

        .search-count {
            font-size: 12px;
            font-weight: 700;
            color: var(--accent);
            background: rgba(88, 86, 214, 0.1);
            padding: 5px 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: inline-block;
        }

        /* --- BUTTONS & INPUTS --- */
        .btn-tg {
            background: var(--accent);
            color: #fff; border: none; width: 100%;
            padding: 20px; border-radius: 22px;
            font-weight: 800; font-size: 16px; cursor: pointer;
            transition: 0.3s; margin-top: 15px;
        }
        .btn-tg:active { transform: scale(0.96); opacity: 0.9; }

        .btn-back { background: none; border: none; color: var(--accent); font-weight: 800; cursor: pointer; margin-bottom: 15px; display: flex; align-items: center; gap: 5px; }

        input, textarea {
            width: 100%; background: #1c1c1e; border: 1px solid var(--border);
            padding: 18px; border-radius: 20px; color: #fff; font-size: 16px; margin-bottom: 15px;
        }

        .admin-item { background: #1c1c1e; padding: 20px; border-radius: 24px; margin-bottom: 12px; border: 1px solid var(--border); text-align: left; }
    </style>
</head>
<body>

    <header>
        <div class="logo" onclick="renderHome()">DELS<span>BASE</span></div>
        <div class="user-pill" onclick="renderProfile()">
            <span id="headerNick">@Guest</span>
            <img id="headerAva" src="https://ui-avatars.com/api/?name=?&background=5856d6&color=fff">
        </div>
    </header>

    <main id="app" class="animate"></main>

    <script>
        // Инициализация Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand(); // Развернуть на весь экран

        // Получаем данные реального пользователя
        const rawUser = tg.initDataUnsafe?.user || {};
        const USER = {
            username: rawUser.username ? `@${rawUser.username}` : "@Unknown",
            first_name: rawUser.first_name || "Пользователь",
            photo: rawUser.photo_url || `https://ui-avatars.com/api/?name=${rawUser.first_name || 'U'}&background=5856d6&color=fff`,
            id: rawUser.id || "00000000"
        };

        // База данных (localStorage)
        let db = {
            scammers: JSON.parse(localStorage.getItem('dels_db_scammers')) || [],
            complaints: JSON.parse(localStorage.getItem('dels_db_complaints')) || [],
            metrics: JSON.parse(localStorage.getItem('dels_db_metrics')) || {}
        };

        function save() {
            localStorage.setItem('dels_db_scammers', JSON.stringify(db.scammers));
            localStorage.setItem('dels_db_complaints', JSON.stringify(db.complaints));
            localStorage.setItem('dels_db_metrics', JSON.stringify(db.metrics));
        }

        function setPage(html) {
            const app = document.getElementById('app');
            app.classList.remove('animate');
            void app.offsetWidth;
            app.innerHTML = html;
            app.classList.add('animate');
            lucide.createIcons();
        }

        // --- ГЛАВНАЯ ---
        function renderHome() {
            setPage(`
                <div style="text-align:center; margin: 20px 0 40px">
                    <h1 style="font-size:32px; font-weight:900; margin:0">DELS <span>BASE</span></h1>
                    <p style="color:var(--hint)">Ваша безопасность в ваших руках</p>
                </div>
                <div class="menu-card" onclick="renderSearch()">
                    <div class="icon-box"><i data-lucide="search"></i></div>
                    <div><h3>Поиск в базе</h3><p>Проверить по базе мошенников</p></div>
                </div>
                <div class="menu-card" onclick="renderReport()">
                    <div class="icon-box" style="color:var(--accent)"><i data-lucide="shield-alert"></i></div>
                    <div><h3>Подать жалобу</h3><p>Сообщить о инциденте</p></div>
                </div>
                <div class="menu-card" onclick="tg.showAlert('Сервис Гаранта доступен в официальном канале')">
                    <div class="icon-box" style="color:var(--success)"><i data-lucide="check-circle"></i></div>
                    <div><h3>DELS Гарант</h3><p>Безопасная сделка</p></div>
                </div>
            `);
        }

        // --- ПРОФИЛЬ ---
        function renderProfile() {
            const isScam = db.scammers.find(s => s.username.toLowerCase() === USER.username.toLowerCase());
            const searches = db.metrics[USER.username.toLowerCase()] || 0;
            
            // Проверка на админа @Treedexe
            const isAdmin = USER.username.toLowerCase() === "@treedexe";
            const adminBtn = isAdmin ? `<button class="btn-tg" style="background:#af52de; margin-top:20px" onclick="renderAdmin()">Админ-панель</button>` : "";

            setPage(`
                <button class="btn-back" onclick="renderHome()"><i data-lucide="chevron-left"></i> Назад</button>
                <div class="glass-panel">
                    <img src="${USER.photo}" style="width:100px; height:100px; border-radius:30px; border:4px solid var(--bg)">
                    <h2 style="margin:15px 0 5px">${USER.first_name}</h2>
                    <div style="color:var(--hint); font-size:14px">${USER.username}</div>
                    
                    <div class="search-count">Вас искали раз: ${searches}</div><br>

                    ${isScam ? '<div class="scam-tag">СТАТУС: МОШЕННИК</div>' : '<div class="scam-tag" style="background:var(--success)">СТАТУС: ЧИСТ</div>'}
                    
                    ${adminBtn}

                    <p style="color:var(--hint); font-size:13px; margin-top:25px">Ваши данные получены напрямую из Telegram API. Ваша репутация в системе безупречна.</p>
                </div>
            `);
        }

        // --- ПОИСК ---
        function renderSearch() {
            setPage(`
                <button class="btn-back" onclick="renderHome()"><i data-lucide="chevron-left"></i> Назад</button>
                <h2 style="margin-bottom:20px">Глобальный поиск</h2>
                <input type="text" id="sq" placeholder="@username или ID">
                <button class="btn-tg" onclick="runSearch()">Найти профиль</button>
                <div id="sr"></div>
            `);
        }

        function runSearch() {
            const q = document.getElementById('sq').value.trim().toLowerCase();
            if(!q) return;

            // Обновляем статистику
            db.metrics[q] = (db.metrics[q] || 0) + 1;
            save();

            const isScam = db.scammers.find(s => s.username.toLowerCase() === q || s.id === q);
            const cleanName = q.replace('@', '');
            const res = document.getElementById('sr');

            res.innerHTML = `
                <div class="glass-panel animate" style="margin-top:20px; border-color:${isScam ? 'var(--danger)' : 'var(--border)'}">
                    <img src="https://ui-avatars.com/api/?name=${cleanName}&background=${isScam ? 'ff3b30' : '333'}&color=fff" style="width:80px; border-radius:22px">
                    <h2 style="margin:10px 0 5px">${q}</h2>
                    <div class="search-count">Проверок этого ника: ${db.metrics[q]}</div><br>
                    
                    ${isScam ? `
                        <div class="scam-tag">ПОДТВЕРЖДЕННЫЙ SCAM</div>
                        <p style="color:var(--danger); font-weight:700; margin-top:15px">${isScam.reason}</p>
                    ` : `
                        <div class="scam-tag" style="background:var(--success)">ЧИСТ В БАЗЕ</div>
                        <p style="color:var(--hint); font-size:13px; margin-top:15px">Пользователь не найден в черном списке. Будьте бдительны!</p>
                    `}
                </div>
            `;
            lucide.createIcons();
        }

        // --- ЖАЛОБА ---
        function renderReport() {
            setPage(`
                <button class="btn-back" onclick="renderHome()"><i data-lucide="chevron-left"></i> Назад</button>
                <h2>Подать жалобу</h2>
                <input type="text" id="rt" placeholder="Ник нарушителя (@...)">
                <textarea id="rr" rows="4" placeholder="Опишите ситуацию..."></textarea>
                <button class="btn-tg" onclick="sendReport()">Отправить @Treedexe</button>
            `);
        }

        function sendReport() {
            const target = document.getElementById('rt').value;
            const text = document.getElementById('rr').value;
            if(!target || !text) return;
            db.complaints.push({ id: Date.now(), from: USER.username, target, text });
            save();
            tg.showPopup({ message: "Жалоба отправлена на рассмотрение." });
            renderHome();
        }

        // --- АДМИНКА ---
        function renderAdmin() {
            if(USER.username.toLowerCase() !== "@treedexe") return renderHome();
            let html = `
                <button class="btn-back" onclick="renderProfile()"><i data-lucide="chevron-left"></i> Назад</button>
                <h2>Очередь жалоб (${db.complaints.length})</h2>
                <div id="adminList"></div>
            `;
            db.complaints.forEach(c => {
                html += `
                    <div class="admin-item animate">
                        <div style="font-size:12px; color:var(--accent)">ОТ: ${c.from}</div>
                        <div style="font-weight:900; font-size:18px; margin:5px 0">ЦЕЛЬ: ${c.target}</div>
                        <p style="color:#ccc; font-size:14px; margin-bottom:15px">${c.text}</p>
                        <div style="display:flex; gap:10px">
                            <button onclick="approve(${c.id})" style="flex:1; background:var(--success); border:none; border-radius:12px; padding:12px; color:#fff; font-weight:800">БАН</button>
                            <button onclick="reject(${c.id})" style="flex:1; background:var(--danger); border:none; border-radius:12px; padding:12px; color:#fff; font-weight:800">ОТКАЗ</button>
                        </div>
                    </div>`;
            });
            setPage(html || '<h2>Жалоб нет</h2>');
        }

        function approve(id) {
            const c = db.complaints.find(x => x.id === id);
            db.scammers.push({ id: id.toString(), username: c.target, reason: c.text });
            db.complaints = db.complaints.filter(x => x.id !== id);
            save(); renderAdmin();
        }

        function reject(id) {
            db.complaints = db.complaints.filter(x => x.id !== id);
            save(); renderAdmin();
        }

        // Инициализация при загрузке
        window.onload = () => {
            document.getElementById('headerNick').innerText = USER.username;
            document.getElementById('headerAva').src = USER.photo;
            renderHome();
        };
    </script>
</body>
</html>
